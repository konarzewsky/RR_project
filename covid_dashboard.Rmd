---
title: "Covid in the EU"
author: "Arkadiusz Koszyk, Wojciech Konarzewski"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: html_document
params:
  country:
    label: "Country"
    value: Entire EU
    input: select
    choices: [Entire EU, Austria, Belgium, Bulgaria, Croatia, Cyprus, Czech Republic, Denmark, Estonia, Finland, France, Germany, Greece, Hungary, Ireland, Italy, Latvia, Lithuania, Luxembourg, Malta, Netherlands, Poland, Portugal, Romania, Slovakia, Slovenia, Spain, Sweden]
  date_from:
    label: "Date from"
    value: "2020-01-22"
    input: date
    min: "2020-01-22"
    max: !r format(Sys.time(), '%Y-%m-%d')
  date_to:
    label: "Date to"
    value: !r format(Sys.time(), '%Y-%m-%d')
    input: date
    min: "2020-01-22"
    max: !r format(Sys.time(), '%Y-%m-%d')
---
### Libraries used
```{r message=FALSE, warning=FALSE}
library(COVID19)
library(dplyr)
library(ggplot2)
library(sqldf)
library(scales)
```

### Loading data for countries within the European Union
```{r }
if (params$country == 'Entire EU') {
  country = c('Austria', 'Belgium', 'Bulgaria', 'Croatia', 'Cyprus', 'Czech Republic', 'Denmark', 'Estonia', 'Finland', 'France', 'Germany', 'Greece', 'Hungary', 'Ireland', 'Italy', 'Latvia', 'Lithuania', 'Luxembourg', 'Malta', 'Netherlands', 'Poland', 'Portugal', 'Romania', 'Slovakia', 'Slovenia', 'Spain', 'Sweden')
} else {
  country = params$country
}

data <- covid19(
  country = country,
  level = 1,
  start = params$date_from,
  end = params$date_to,
  verbose = FALSE
)
```

### Epidemiological variables
Definitions of variables are taken from the documentation of the [COVID-19 Data Hub](https://covid19datahub.io/index.html#covid-19-data-hub-)

| Variable    | Description |
| :---------- | :---------------- |
| `confirmed` | Cumulative number of confirmed cases. |
| `deaths`    | Cumulative number of deaths.        |
| `recovered` | Cumulative number of patients released from hospitals or reported recovered.        |
| `tests`    | Cumulative number of tests.       |
| `vaccines`    | Cumulative number of total doses administered.        |
| `people_vaccinated`    | Cumulative number of people who received at least one vaccine dose.        |
| `people_fully_vaccinated`    | Cumulative number of people who received all doses prescribed by the vaccination protocol.        |
| `hosp`    | Number of hospitalized patients on date.        |
| `icu`    | Number of hospitalized patients in intensive therapy on date.         |
| `vent`    | Number of patients requiring invasive ventilation on date.        |
| `population`    | Total population.        |
	
	

```{r }
data$date_char = as.character(data$date)
data_time_tests <- sqldf(
  "select
    date_char as date,
    sum(tests)/1000 as tests
  from data
  group by 1
  order by 1 ASC",
  method = "raw"
)

ggplot(data = data_time_tests, aes(x = date, y = tests)) + 
  geom_bar(position="stack", stat="identity") +
  labs(
    x = "",
    y = "",
    title = "Daily number of tests (thousands)",
    subtitle = paste(params$country,", ",params$date_from," - ", params$date_to, sep=""),
  ) + scale_y_continuous(labels = comma) +
  scale_x_discrete(guide = guide_axis(check.overlap = TRUE)) +
  theme_classic()
```

```{r }

```

```{r }

```
